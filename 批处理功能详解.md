# æ‰¹é‡è§†é¢‘å¤„ç†åŠŸèƒ½è¯¦è§£

## æ€»ä½“æ¶æ„

æ‰¹é‡å¤„ç†ç³»ç»Ÿé‡‡ç”¨**å¤šçº¿ç¨‹ + äº‹ä»¶é©±åŠ¨**çš„æ¶æ„ï¼Œå®ç°é«˜æ•ˆçš„å¹¶å‘è§†é¢‘å¤„ç†èƒ½åŠ›ã€‚

### æ ¸å¿ƒç»„ä»¶
1. **BatchProcessDialog** - ç”¨æˆ·ç•Œé¢ç®¡ç†
2. **BatchProcessThread** - åå°å¤„ç†çº¿ç¨‹
3. **é…ç½®ç®¡ç†ç³»ç»Ÿ** - æ”¯æŒç»Ÿä¸€é…ç½®å’Œå•ç‹¬é…ç½®
4. **è¿›åº¦ç›‘æ§ç³»ç»Ÿ** - å®æ—¶æ˜¾ç¤ºå¤„ç†çŠ¶æ€
5. **é”™è¯¯å¤„ç†æœºåˆ¶** - è‡ªåŠ¨æ¢å¤å’Œé”™è¯¯æŠ¥å‘Š

## è¯¦ç»†å®ç°æµç¨‹

### 1. æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·ç•Œé¢å±‚    â”‚    â”‚   ä¸šåŠ¡é€»è¾‘å±‚    â”‚    â”‚   æ•°æ®å¤„ç†å±‚    â”‚
â”‚ BatchProcessDialogâ”‚    â”‚BatchProcessThreadâ”‚    â”‚  å„åŠŸèƒ½æ¨¡å—     â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ æ–‡ä»¶åˆ—è¡¨ç®¡ç†  â”‚â—„â”€â”€â–ºâ”‚ â€¢ å¤šçº¿ç¨‹è°ƒåº¦    â”‚â—„â”€â”€â–ºâ”‚ â€¢ éŸ³é¢‘æå–      â”‚
â”‚ â€¢ é…ç½®ç•Œé¢      â”‚    â”‚ â€¢ è¿›åº¦ç›‘æ§      â”‚    â”‚ â€¢ è¯­éŸ³è¯†åˆ«      â”‚
â”‚ â€¢ è¿›åº¦æ˜¾ç¤º      â”‚    â”‚ â€¢ é”™è¯¯å¤„ç†      â”‚    â”‚ â€¢ æ–‡æœ¬ç¿»è¯‘      â”‚
â”‚ â€¢ æ—¥å¿—è®°å½•      â”‚    â”‚ â€¢ çŠ¶æ€ç®¡ç†      â”‚    â”‚ â€¢ è¯­éŸ³åˆæˆ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ–‡ä»¶ç®¡ç†æµç¨‹

#### 2.1 æ–‡ä»¶æ·»åŠ æœºåˆ¶
```python
def addFiles(self):
    """æ·»åŠ è§†é¢‘æ–‡ä»¶"""
    files, _ = QFileDialog.getOpenFileNames(
        self, "é€‰æ‹©è§†é¢‘æ–‡ä»¶", "",
        "è§†é¢‘æ–‡ä»¶ (*.mp4 *.avi *.mkv *.mov *.wmv *.flv *.3gp);;æ‰€æœ‰æ–‡ä»¶ (*)"
    )
    
    if files:
        added_count = 0
        for file in files:
            if file not in self.file_list:
                self.file_list.append(file)
                
                # æ·»åŠ åˆ°åˆ—è¡¨æ˜¾ç¤º
                item = QListWidgetItem(os.path.basename(file))
                item.setData(Qt.UserRole, file)  # å­˜å‚¨å®Œæ•´è·¯å¾„
                item.setToolTip(file)
                self.file_list_widget.addItem(item)
                
                added_count += 1
        
        self.updateFileCount()
        if added_count > 0:
            self.addLog(f"ğŸ“ æ·»åŠ äº† {added_count} ä¸ªæ–‡ä»¶")
```

#### 2.2 æ–‡ä»¶å¤¹æ‰¹é‡æ·»åŠ 
```python
def addFolder(self):
    """æ‰¹é‡æ·»åŠ æ–‡ä»¶å¤¹ä¸­çš„è§†é¢‘æ–‡ä»¶"""
    folder = QFileDialog.getExistingDirectory(self, "é€‰æ‹©åŒ…å«è§†é¢‘æ–‡ä»¶çš„æ–‡ä»¶å¤¹")
    
    if folder:
        video_extensions = ['.mp4', '.avi', '.mkv', '.mov', '.wmv', '.flv', '.3gp']
        added_count = 0
        
        # é€’å½’æœç´¢è§†é¢‘æ–‡ä»¶
        for root, dirs, files in os.walk(folder):
            for file in files:
                if any(file.lower().endswith(ext) for ext in video_extensions):
                    file_path = os.path.join(root, file)
                    if file_path not in self.file_list:
                        self.file_list.append(file_path)
                        
                        item = QListWidgetItem(os.path.relpath(file_path, folder))
                        item.setData(Qt.UserRole, file_path)
                        item.setToolTip(file_path)
                        self.file_list_widget.addItem(item)
                        
                        added_count += 1
        
        self.updateFileCount()
        self.addLog(f"ğŸ“ ä»æ–‡ä»¶å¤¹æ·»åŠ äº† {added_count} ä¸ªè§†é¢‘æ–‡ä»¶")
```

### 3. é…ç½®ç®¡ç†ç³»ç»Ÿ

#### 3.1 åŒæ¨¡å¼é…ç½®æ”¯æŒ

**ç»Ÿä¸€é…ç½®æ¨¡å¼ï¼š**
- æ‰€æœ‰æ–‡ä»¶ä½¿ç”¨ç›¸åŒçš„å¤„ç†å‚æ•°
- é€‚åˆæ‰¹é‡å¤„ç†ç›¸ä¼¼ç±»å‹çš„è§†é¢‘
- é…ç½®ç®€å•ï¼Œæ“ä½œä¾¿æ·

**å•ç‹¬é…ç½®æ¨¡å¼ï¼š**
- æ¯ä¸ªæ–‡ä»¶å¯ä»¥æœ‰ç‹¬ç«‹çš„å¤„ç†å‚æ•°
- é€‚åˆå¤„ç†ä¸åŒç±»å‹çš„è§†é¢‘æ–‡ä»¶
- çµæ´»æ€§é«˜ï¼Œç²¾ç¡®æ§åˆ¶

```python
def getDefaultConfig(self):
    """è·å–é»˜è®¤é…ç½®"""
    return {
        'conversion_type': 'æ™ºèƒ½è½¬æ¢',
        'voice_type_cn': 'xiaoyan',
        'voice_type_en': 'x4_EnUs_Laura_education',
        'speed': 100,
        'volume': 80,
        'quality': 'é«˜è´¨é‡',
        'subtitle_mode': 'ç¡¬å­—å¹•ï¼ˆçƒ§å½•åˆ°è§†é¢‘ï¼‰',
        'concurrent_count': 1
    }

def saveCurrentConfig(self, file_path):
    """ä¿å­˜å½“å‰æ–‡ä»¶çš„é…ç½®"""
    if not file_path:
        return
    
    config = {
        'conversion_type': self.conversion_combo.currentText(),
        'voice_type_cn': self.voice_combo_cn.currentText().split(' (')[0],
        'voice_type_en': self.voice_combo_en.currentText().split(' (')[0],
        'speed': self.speed_slider.value(),
        'volume': self.volume_slider.value(),
        'quality': self.quality_combo.currentText(),
        'subtitle_mode': self.subtitle_combo.currentText(),
        'concurrent_count': self.concurrent_combo.currentIndex() + 1
    }
    
    self.file_configs[file_path] = config
    self.addLog(f"ğŸ’¾ å·²ä¿å­˜æ–‡ä»¶é…ç½®: {os.path.basename(file_path)}")
```

#### 3.2 é…ç½®ç»§æ‰¿æœºåˆ¶
```python
def loadConfigForFile(self, file_path):
    """åŠ è½½æ–‡ä»¶çš„é…ç½®ï¼Œæ”¯æŒä»ä¸»ç•Œé¢ç»§æ‰¿"""
    if file_path in self.file_configs:
        config = self.file_configs[file_path]
    else:
        # ä»ä¸»ç•Œé¢ç»§æ‰¿é…ç½®
        config = self.reloadConfigFromMainInterface()
        if config:
            self.file_configs[file_path] = config
        else:
            config = self.getDefaultConfig()
    
    # åº”ç”¨é…ç½®åˆ°ç•Œé¢
    self.applyConfigToUI(config)
    return config
```

### 4. å¤šçº¿ç¨‹å¤„ç†æœºåˆ¶

#### 4.1 çº¿ç¨‹æ¶æ„è®¾è®¡
```python
class BatchProcessThread(QThread):
    # ä¿¡å·å®šä¹‰
    progress = pyqtSignal(int)                    # æ€»ä½“è¿›åº¦
    current_file = pyqtSignal(str)                # å½“å‰å¤„ç†æ–‡ä»¶
    file_completed = pyqtSignal(str, bool, str)   # æ–‡ä»¶å®ŒæˆçŠ¶æ€
    all_completed = pyqtSignal()                  # å…¨éƒ¨å®Œæˆ
    subtitle_generated = pyqtSignal(str, str, str) # å­—å¹•ç”Ÿæˆ
    step_progress = pyqtSignal(str, str)          # æ­¥éª¤è¿›åº¦
    
    def __init__(self, file_list, output_dir, file_configs=None, 
                 global_config=None, concurrent_count=1):
        super().__init__()
        self.file_list = file_list
        self.output_dir = output_dir
        self.file_configs = file_configs or {}
        self.global_config = global_config
        self.concurrent_count = max(1, min(4, concurrent_count))
        self.is_running = True
```

#### 4.2 å¹¶å‘å¤„ç†å®ç°
```python
def run(self):
    """ä¸»å¤„ç†å¾ªç¯ - æ”¯æŒå•çº¿ç¨‹å’Œå¤šçº¿ç¨‹æ¨¡å¼"""
    try:
        total_files = len(self.file_list)
        completed_files = 0
        
        if self.concurrent_count == 1:
            # å•çº¿ç¨‹æ¨¡å¼ï¼šé¡ºåºå¤„ç†
            for i, video_file in enumerate(self.file_list):
                if not self.is_running:
                    break
                
                success, message = self._process_file_with_config(
                    video_file, i, total_files
                )
                if success:
                    completed_files += 1
                
                # æ›´æ–°æ€»è¿›åº¦
                progress = int((i + 1) / total_files * 100)
                self.progress.emit(progress)
        else:
            # å¤šçº¿ç¨‹æ¨¡å¼ï¼šå¹¶å‘å¤„ç†
            import concurrent.futures
            import queue
            
            progress_queue = queue.Queue()
            completed_count = 0
            
            def worker(video_file, index):
                """å·¥ä½œçº¿ç¨‹å‡½æ•°"""
                try:
                    success, message = self._process_file_with_config(
                        video_file, index, total_files
                    )
                    progress_queue.put(('completed', video_file, success, message, index))
                    return success, message
                except Exception as e:
                    error_msg = f"å¤„ç†æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯: {str(e)}"
                    progress_queue.put(('completed', video_file, False, error_msg, index))
                    return False, error_msg
            
            # ä½¿ç”¨çº¿ç¨‹æ± æ‰§è¡Œå¹¶å‘å¤„ç†
            with concurrent.futures.ThreadPoolExecutor(
                max_workers=self.concurrent_count
            ) as executor:
                # æäº¤æ‰€æœ‰ä»»åŠ¡
                future_to_file = {
                    executor.submit(worker, video_file, i): (video_file, i)
                    for i, video_file in enumerate(self.file_list)
                }
                
                # ç›‘æ§è¿›åº¦
                while completed_count < total_files and self.is_running:
                    try:
                        # æ£€æŸ¥é˜Ÿåˆ—ä¸­çš„å®Œæˆé€šçŸ¥
                        while not progress_queue.empty():
                            event_type, video_file, success, message, index = progress_queue.get_nowait()
                            if event_type == 'completed':
                                self.file_completed.emit(video_file, success, message)
                                completed_count += 1
                                if success:
                                    completed_files += 1
                                
                                # æ›´æ–°æ€»è¿›åº¦
                                progress = int(completed_count / total_files * 100)
                                self.progress.emit(progress)
                        
                        # çŸ­æš‚ä¼‘çœ é¿å…CPUè¿‡åº¦å ç”¨
                        self.msleep(100)
                        
                    except queue.Empty:
                        pass
        
        print(f"æ‰¹å¤„ç†å®Œæˆ: {completed_files}/{total_files} ä¸ªæ–‡ä»¶æˆåŠŸå¤„ç†")
        self.all_completed.emit()
        
    except Exception as e:
        print(f"æ‰¹å¤„ç†çº¿ç¨‹é”™è¯¯: {e}")
        traceback.print_exc()
```

### 5. å•æ–‡ä»¶å¤„ç†æµç¨‹

#### 5.1 å¤„ç†æ­¥éª¤åˆ†è§£
```python
def process_single_file(self, video_file, output_dir, conversion_type, voice_params):
    """å¤„ç†å•ä¸ªæ–‡ä»¶çš„å®Œæ•´æµç¨‹"""
    try:
        if not self.is_running:
            return False, "å¤„ç†å·²åœæ­¢"
        
        file_name = os.path.basename(video_file)
        base_name = os.path.splitext(file_name)[0]
        
        # åˆ›å»ºæ–‡ä»¶ä¸“ç”¨è¾“å‡ºç›®å½•
        file_output_dir = os.path.join(output_dir, base_name)
        os.makedirs(file_output_dir, exist_ok=True)
        
        # æ­¥éª¤1: éŸ³é¢‘æå–
        self.step_progress.emit("æ­¥éª¤ 1/5", f"æ­£åœ¨æå–éŸ³é¢‘: {file_name}")
        import generateWav
        clean_name = re.sub(r'[^\w\-_]', '_', base_name)
        audio_filename = f'{clean_name}_extractedAudio.wav'
        wav_path = generateWav.run(video_file, file_output_dir, audio_filename)
        
        if not wav_path or not os.path.exists(wav_path):
            return False, "éŸ³é¢‘æå–å¤±è´¥ - è¯·æ£€æŸ¥è§†é¢‘æ–‡ä»¶æ˜¯å¦åŒ…å«éŸ³é¢‘è½¨é“"
        
        # æ­¥éª¤2: ç”Ÿæˆæ— å£°è§†é¢‘
        self.step_progress.emit("æ­¥éª¤ 2/5", f"æ­£åœ¨ç”Ÿæˆæ— å£°è§†é¢‘: {file_name}")
        import addNewSound
        video_filename = f'{clean_name}_videoWithoutAudio.mp4'
        video_without_sound = addNewSound.del_audio(
            video_file, file_output_dir, video_filename
        )
        
        if not video_without_sound or not os.path.exists(video_without_sound):
            return False, "æ— å£°è§†é¢‘ç”Ÿæˆå¤±è´¥ - è¯·æ£€æŸ¥è§†é¢‘æ–‡ä»¶æ ¼å¼"
        
        # æ­¥éª¤3: è¯­éŸ³è¯†åˆ«
        self.step_progress.emit("æ­¥éª¤ 3/5", f"æ­£åœ¨è¯†åˆ«è¯­éŸ³ï¼Œéœ€è¦è¾ƒé•¿æ—¶é—´...")
        import video_to_txt
        subtitle_filename = f'{clean_name}_subtitle.srt'
        subtitle_file = video_to_txt.run(wav_path, file_output_dir, subtitle_filename)
        
        if not subtitle_file or not os.path.exists(subtitle_file):
            return False, "è¯­éŸ³è¯†åˆ«å¤±è´¥ - è¯·æ£€æŸ¥APIé…ç½®æˆ–éŸ³é¢‘è´¨é‡"
        
        # è¯»å–å¹¶å‘é€åŸå§‹å­—å¹•
        try:
            with open(subtitle_file, 'r', encoding='utf-8') as f:
                subtitle_content = f.read()
            self.subtitle_generated.emit(video_file, "original", subtitle_content)
        except Exception as e:
            print(f"è¯»å–å­—å¹•æ–‡ä»¶å¤±è´¥: {e}")
        
        # æ­¥éª¤4: è¯­éŸ³åˆæˆ
        self.step_progress.emit("æ­¥éª¤ 4/5", f"æ­£åœ¨åˆæˆè¯­éŸ³: {file_name}")
        
        # æ ¹æ®è½¬æ¢ç±»å‹æ‰§è¡Œç›¸åº”çš„å¤„ç†
        if conversion_type == "è‹±æ–‡è½¬è‹±æ–‡":
            import syntheticSpeech
            new_audio_path = syntheticSpeech.run(
                subtitle_file, file_output_dir, 
                f'{clean_name}_newAudio.wav', voice_params
            )
        elif conversion_type == "ä¸­æ–‡è½¬ä¸­æ–‡":
            import syntheticSpeechCn
            new_audio_path = syntheticSpeechCn.run(
                subtitle_file, file_output_dir,
                f'{clean_name}_newAudio.wav', voice_params
            )
        elif conversion_type == "è‹±æ–‡è½¬ä¸­æ–‡":
            import syntheticSpeechTranslateToCn
            new_audio_path = syntheticSpeechTranslateToCn.run(
                subtitle_file, file_output_dir,
                f'{clean_name}_newAudio.wav', voice_params
            )
        elif conversion_type == "ä¸­æ–‡è½¬è‹±æ–‡":
            import syntheticSpeechTranslateToEn
            new_audio_path = syntheticSpeechTranslateToEn.run(
                subtitle_file, file_output_dir,
                f'{clean_name}_newAudio.wav', voice_params
            )
        elif conversion_type == "æ™ºèƒ½è½¬æ¢":
            # æ™ºèƒ½è½¬æ¢ï¼šæ£€æµ‹è¯­è¨€å¹¶é€‰æ‹©å¯¹åº”çš„å¤„ç†æ–¹æ³•
            with open(subtitle_file, 'r', encoding='utf-8') as f:
                subtitle_content = f.read()
            
            detected_lang = self.detectLanguage(subtitle_content)
            
            if detected_lang == "chinese":
                import syntheticSpeechTranslateToEn
                new_audio_path = syntheticSpeechTranslateToEn.run(
                    subtitle_file, file_output_dir,
                    f'{clean_name}_newAudio.wav', voice_params
                )
            else:  # english or unknown
                import syntheticSpeechTranslateToCn
                new_audio_path = syntheticSpeechTranslateToCn.run(
                    subtitle_file, file_output_dir,
                    f'{clean_name}_newAudio.wav', voice_params
                )
        
        if not new_audio_path or not os.path.exists(new_audio_path):
            return False, "è¯­éŸ³åˆæˆå¤±è´¥ - è¯·æ£€æŸ¥TTS APIé…ç½®"
        
        # æ­¥éª¤5: æœ€ç»ˆåˆæˆ
        self.step_progress.emit("æ­¥éª¤ 5/5", f"æ­£åœ¨åˆæˆæœ€ç»ˆè§†é¢‘: {file_name}")
        
        final_video_name = f'{clean_name}_final.mp4'
        final_video_path = os.path.join(file_output_dir, final_video_name)
        
        # è¿›åº¦å›è°ƒå‡½æ•°
        def progress_callback(progress, message):
            if self.is_running:
                detailed_message = f"{message} ({progress}%)"
                self.step_progress.emit("åˆæˆè§†é¢‘", detailed_message)
        
        success = addNewSound.replace_audio_with_progress(
            video_without_sound, new_audio_path, final_video_path, progress_callback
        )
        
        if not success or not os.path.exists(final_video_path):
            return False, "æœ€ç»ˆè§†é¢‘åˆæˆå¤±è´¥"
        
        return True, f"å¤„ç†å®Œæˆï¼Œè¾“å‡ºæ–‡ä»¶: {final_video_path}"
        
    except Exception as e:
        error_msg = f"å¤„ç†æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯: {str(e)}"
        print(error_msg)
        return False, error_msg
```

### 6. è¿›åº¦ç›‘æ§ç³»ç»Ÿ

#### 6.1 å¤šå±‚æ¬¡è¿›åº¦æ˜¾ç¤º
```python
def updateBatchProgress(self, progress):
    """æ›´æ–°æ€»ä½“è¿›åº¦"""
    self.overall_progress.setValue(progress)
    self.overall_progress_label.setText(f"æ€»ä½“è¿›åº¦: {progress}%")

def updateCurrentFile(self, file_name):
    """æ›´æ–°å½“å‰å¤„ç†çš„æ–‡ä»¶"""
    if "æ­£åœ¨å¤„ç†:" in file_name:
        self.current_file_label.setText(f"å½“å‰æ–‡ä»¶: {file_name}")
        self.status_label.setText(f"çŠ¶æ€: {file_name}")
    else:
        short_name = os.path.basename(file_name)
        self.current_file_label.setText(f"å½“å‰æ–‡ä»¶: {short_name}")
        self.status_label.setText(f"æ­£åœ¨å¤„ç†: {short_name}")
    
    # é‡ç½®å½“å‰æ–‡ä»¶è¿›åº¦
    self.current_file_progress.setValue(0)

def updateStepProgress(self, step_name, detail_message):
    """æ›´æ–°å¤„ç†æ­¥éª¤è¿›åº¦"""
    # æ›´æ–°çŠ¶æ€æ ‡ç­¾æ˜¾ç¤ºè¯¦ç»†æ­¥éª¤
    self.status_label.setText(f"çŠ¶æ€: {step_name} - {detail_message}")
    
    # åœ¨æ—¥å¿—ä¸­è®°å½•æ­¥éª¤è¿›åº¦
    if step_name.startswith("æ­¥éª¤"):
        self.addLog(f"ğŸ“‹ {step_name}: {detail_message}")
    elif step_name == "é”™è¯¯":
        self.addLog(f"âŒ é”™è¯¯: {detail_message}")
    else:
        self.addLog(f"â„¹ï¸ {step_name}: {detail_message}")
```

#### 6.2 å®æ—¶æ—¥å¿—ç³»ç»Ÿ
```python
def addLog(self, message):
    """æ·»åŠ æ—¥å¿—æ¶ˆæ¯"""
    timestamp = time.strftime("%H:%M:%S")
    formatted_message = f"[{timestamp}] {message}"
    
    # æ·»åŠ åˆ°æ—¥å¿—æ˜¾ç¤º
    self.log_text.append(formatted_message)
    
    # è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
    cursor = self.log_text.textCursor()
    cursor.movePosition(cursor.End)
    self.log_text.setTextCursor(cursor)
    
    # å¼ºåˆ¶æ›´æ–°ç•Œé¢
    QApplication.processEvents()
```

### 7. é”™è¯¯å¤„ç†æœºåˆ¶

#### 7.1 å¤šçº§é”™è¯¯æ¢å¤
```python
def onFileCompleted(self, file_path, success, message):
    """æ–‡ä»¶å¤„ç†å®Œæˆå›è°ƒ"""
    short_name = os.path.basename(file_path)
    if success:
        self.addLog(f"âœ… {short_name} å¤„ç†æˆåŠŸ")
        self.current_file_progress.setValue(100)
    else:
        self.addLog(f"âŒ {short_name} å¤„ç†å¤±è´¥: {message}")
        self.current_file_progress.setValue(0)
        
        # é”™è¯¯å¤„ç†ç­–ç•¥
        if "API" in message:
            self.addLog("ğŸ’¡ å»ºè®®æ£€æŸ¥APIé…ç½®å’Œç½‘ç»œè¿æ¥")
        elif "éŸ³é¢‘" in message:
            self.addLog("ğŸ’¡ å»ºè®®æ£€æŸ¥è§†é¢‘æ–‡ä»¶æ˜¯å¦åŒ…å«éŸ³é¢‘è½¨é“")
        elif "æ ¼å¼" in message:
            self.addLog("ğŸ’¡ å»ºè®®è½¬æ¢è§†é¢‘æ ¼å¼åé‡è¯•")
```

#### 7.2 èµ„æºç®¡ç†
```python
def stopBatchProcessing(self):
    """åœæ­¢æ‰¹é‡å¤„ç†"""
    if self.process_thread and self.process_thread.isRunning():
        self.addLog("ğŸ›‘ æ­£åœ¨åœæ­¢å¤„ç†...")
        self.process_thread.stop_processing()
        
        # ç­‰å¾…çº¿ç¨‹ç»“æŸ
        if not self.process_thread.wait(5000):  # ç­‰å¾…5ç§’
            self.addLog("âš ï¸ å¼ºåˆ¶ç»ˆæ­¢å¤„ç†çº¿ç¨‹")
            self.process_thread.terminate()
            self.process_thread.wait()
        
        self.addLog("âœ‹ æ‰¹é‡å¤„ç†å·²åœæ­¢")
    
    # æ¢å¤ç•Œé¢çŠ¶æ€
    self.start_btn.setEnabled(True)
    self.stop_btn.setEnabled(False)
    self.add_files_btn.setEnabled(True)
    # ... å…¶ä»–æ§ä»¶çŠ¶æ€æ¢å¤
```

### 8. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 8.1 å¹¶å‘æ§åˆ¶
- **è‡ªé€‚åº”å¹¶å‘æ•°é‡**ï¼šæ ¹æ®ç³»ç»Ÿæ€§èƒ½è‡ªåŠ¨è°ƒæ•´
- **èµ„æºç›‘æ§**ï¼šé˜²æ­¢å†…å­˜å’ŒCPUè¿‡è½½
- **ä¼˜å…ˆçº§è°ƒåº¦**ï¼šå…³é”®æ–‡ä»¶ä¼˜å…ˆå¤„ç†

#### 8.2 ç¼“å­˜æœºåˆ¶
- **ä¸­é—´æ–‡ä»¶ç¼“å­˜**ï¼šé¿å…é‡å¤å¤„ç†
- **é…ç½®ç¼“å­˜**ï¼šå¿«é€ŸåŠ è½½å†å²é…ç½®
- **APIç»“æœç¼“å­˜**ï¼šå‡å°‘é‡å¤APIè°ƒç”¨

#### 8.3 å†…å­˜ç®¡ç†
- **åˆ†ç‰‡å¤„ç†**ï¼šå¤§æ–‡ä»¶åˆ†æ®µå¤„ç†
- **åŠæ—¶é‡Šæ”¾**ï¼šå¤„ç†å®Œæˆåç«‹å³é‡Šæ”¾èµ„æº
- **åƒåœ¾å›æ”¶**ï¼šå®šæœŸæ¸…ç†ä¸´æ—¶æ–‡ä»¶

## æ€»ç»“

æ‰¹é‡å¤„ç†ç³»ç»Ÿé€šè¿‡ä»¥ä¸‹æ ¸å¿ƒæŠ€æœ¯å®ç°é«˜æ•ˆçš„è§†é¢‘å¤„ç†ï¼š

1. **å¤šçº¿ç¨‹å¹¶å‘æ¶æ„** - å……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æº
2. **çµæ´»é…ç½®ç³»ç»Ÿ** - æ”¯æŒç»Ÿä¸€å’Œä¸ªæ€§åŒ–é…ç½®
3. **å®æ—¶è¿›åº¦ç›‘æ§** - æä¾›è¯¦ç»†çš„å¤„ç†çŠ¶æ€
4. **å®Œå–„é”™è¯¯å¤„ç†** - ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§
5. **æ™ºèƒ½èµ„æºç®¡ç†** - ä¼˜åŒ–å†…å­˜å’ŒCPUä½¿ç”¨

è¿™å¥—ç³»ç»Ÿèƒ½å¤Ÿé«˜æ•ˆå¤„ç†å¤§é‡è§†é¢‘æ–‡ä»¶ï¼ŒåŒæ—¶ä¿æŒè‰¯å¥½çš„ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿç¨³å®šæ€§ã€‚ 